<div class="orders-container">
  <h2>📦 Orders Dashboard</h2>

  <!-- 🔍 Search + Filter -->
  <div class="filters">
    <input
      type="text"
      placeholder="Search by Order ID or Customer Name..."
      [(ngModel)]="searchQuery"
      (input)="applyFilters()"
    />

    <select [(ngModel)]="filterStatus" (change)="applyFilters()">
      <option value="">All Status</option>
      <option>Preparing</option>
      <option>Packed</option>
      <option>Shipped</option>
      <option>Delivered</option>
      <option>Cancelled</option>
    </select>

    <button class="secondary-btn" (click)="clearFilters()">✖ Clear</button>

    <!-- 📥 Export Button -->
    <button class="export-btn" (click)="downloadExcel()">⬇️ Export to Excel</button>
  </div>

  <!-- Empty state -->
  <div *ngIf="filteredOrders.length === 0" class="empty-state">
    No orders match your filters.
  </div>

  <!-- Orders Table -->
  <table class="orders-table" *ngIf="filteredOrders.length">
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Total</th>
        <th>Status</th>
        <th>AWB</th>
        <th>Created At</th>
        <th>Update</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let order of filteredOrders">
        <!-- Make Order ID clickable to open details -->
        <td>
          <button
            class="link-btn"
            (click)="viewDetails(order.orderId); $event.stopPropagation()"
            [disabled]="!order.orderId"
            title="View order details"
          >
            {{ order.orderId }}
          </button>
        </td>

        <td>{{ order.checkoutData?.name || '—' }}</td>
        <td>₹{{ order.totalAmount }}</td>

        <td>
          <span class="status" [ngClass]="(order.status || '').toLowerCase()">
            {{ order.status || '—' }}
          </span>
        </td>

 <td>
  <span>{{ order.awb || '—' }}</span>
  <button
    *ngIf="order.awb"
    class="tiny-btn"
    (click)="copyAwb(order.awb, $event)"
    title="Copy AWB"
  >
    Copy
  </button>
</td>


<td>{{ order.createdAt | date:'medium':'Asia/Kolkata' }}</td>

        <td>
          <!-- ✅ Admin can update until Packed -->
          <select
            [(ngModel)]="order.status"
            (change)="updateStatus(order, order.status); $event.stopPropagation()"
            [disabled]="order.status === 'Shipped' || order.status === 'Delivered' || order.status === 'Cancelled'"
            title="Update status"
          >
            <option>Preparing</option>
            <option>Packed</option>
          </select>

          <!-- 🚚 Show courier status as read-only -->
          <div *ngIf="order.status === 'Shipped' || order.status === 'Delivered'" class="courier-readonly">
            <span>📦 Status via Courier</span>
          </div>
        </td>

        <td class="actions">
          <!-- View button (alternative to clicking Order ID) -->
          <button
            class="view-btn"
            (click)="viewDetails(order.orderId); $event.stopPropagation()"
            [disabled]="!order.orderId"
          >
            👁 View
          </button>

          <!-- Cancel -->
          <button
            class="cancel-btn"
            (click)="cancelOrder(order.orderId); $event.stopPropagation()"
            [disabled]="order.status === 'Shipped' || order.status === 'Delivered' || order.status === 'Cancelled'"
          >
            ❌ Cancel
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
