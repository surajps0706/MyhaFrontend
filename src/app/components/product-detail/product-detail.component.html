<div class="product-detail-container" *ngIf="product; else loading">
  <!-- Left: Image Section -->
  <div class="image-section">
    <div class="thumbnails">
      <img
        *ngFor="let img of product.images; let i = index"
        [src]="img"
        [alt]="product.name + ' thumbnail ' + (i + 1)"
        loading="lazy"
        (click)="selectImage(img)"
        [class.active]="img === selectedImage"
      />
    </div>
    <div class="main-image">
      <img [src]="selectedImage" [alt]="product.name" />
    </div>
  </div>

  <!-- Right: Info Section -->
  <div class="info-section">
    <h2 class="product-name">{{ product.name }}</h2>

    <!-- Price -->
    <div class="price-container">
      <span class="price-label">Price:</span>
      <span class="price-value">{{ product.price }}</span>
    </div>

    <!-- Collapsible Description -->
    <div class="collapsible-description">
      <button class="toggle-btn" type="button" (click)="toggleDescription()">
        {{ showDescription ? 'Hide' : 'Show' }} Description
        <span [class.rotated]="showDescription">‚ñº</span>
      </button>
      <div
        class="description-content"
        [class.open]="showDescription"
        [innerHTML]="formattedDescription"
      ></div>
    </div>

<!-- Sizing Mode Switch -->
<div class="sizing-mode-container">
  <div class="sizing-mode-label">Choose Sizing Mode:</div>
  <div class="sizing-mode-switch">
    <button
      type="button"
      (click)="setSizingMode('size')"
      [class.active]="sizingMode === 'size'"
    >
      Standard Size
    </button>
    <button
      type="button"
      (click)="setSizingMode('measurements')"
      [class.active]="sizingMode === 'measurements'"
    >
      Custom Measurements
    </button>
  </div>
</div>


    <!-- Size Selection -->
    <div class="select-row">
      <label for="size">Size:</label>
      <select
        id="size"
        class="size-dropdown"
        [(ngModel)]="product.selectedSize"
        (ngModelChange)="onSizeChange($event)"
        [disabled]="sizeDisabled"
      >
        <option *ngFor="let size of standardSizes" [value]="size">{{ size }}</option>
      </select>

      <div class="size-chart-link" (click)="showSizeChart = !showSizeChart">üìè View Size Chart</div>
      <div class="size-chart-img" *ngIf="showSizeChart">
        <img
          src="https://res.cloudinary.com/dw35epojg/image/upload/v1754143979/size-chart_bu3k4d.jpg"
          alt="Size chart"
        />
      </div>

      <p *ngIf="sizeModeNote" class="customization-hint" style="margin-top:6px;">
        {{ sizeModeNote }}
      </p>
    </div>

    <!-- Measurements -->
    <div class="measurements-section" [class.disabled]="measurementsDisabled">
      <h4>Measurements:</h4>
      <div class="measurements-grid">
        <div class="measurement-row" *ngFor="let field of measurementFields">
          <label>
            {{ field.label }}
            <span *ngIf="isRequired(field.key) && !measurementsDisabled" class="required-star">*</span>
          </label>

          <input
            type="text"
            [(ngModel)]="measurements[field.key]"
            (ngModelChange)="onMeasurementChanged(field.key, $event)"
            [name]="field.key"
            placeholder="in inches"
            [required]="isRequired(field.key) && !measurementsDisabled"
            [disabled]="measurementsDisabled"
            #inputRef="ngModel"
            [ngClass]="{
              'invalid': !measurementsDisabled && isRequired(field.key) && inputRef.invalid && inputRef.touched
            }"
            (blur)="inputRef.control.markAsTouched()"
          />

          <div
            *ngIf="!measurementsDisabled && isRequired(field.key) && inputRef.invalid && inputRef.touched"
            class="error-msg"
          >
            {{ field.label }} is required
          </div>
        </div>
      </div>

      <p *ngIf="measModeNote" class="customization-hint" style="margin-top:6px;">
        {{ measModeNote }}
      </p>
    </div>

    <!-- Sleeve Selection -->
    <div class="sleeve-options">
      <h4>Sleeve Type:</h4>
      <div class="sleeve-list">
        <label *ngFor="let option of sleeveOptions">
          <input
            type="radio"
            name="sleeve"
            [value]="option"
            [(ngModel)]="selectedSleeve"
          />
          {{ option.name }} ({{ option.price > 0 ? '+‚Çπ' + option.price : 'Free' }})
        </label>
      </div>
    </div>

    <!-- Extra Height -->
    <div *ngIf="isKurti" class="extra-height-section">
      <h4>Extra Height (‚Çπ{{ extraHeightPrice }})</h4>
      <input
        class="extra-height"
        type="text"
        [(ngModel)]="preferredHeight"
        (ngModelChange)="onHeightChange($event)"
        placeholder="Enter desired height in inches"
      />
      <p class="extra-height-note">
        *Extra ‚Çπ150 will be charged if height exceeds 35 inches.
      </p>
    </div>

    <div *ngIf="!isKurti" class="extra-height-section">
      <h4>Extra Height (Optional)</h4>
      <input
        class="extra-height"
        type="text"
        [(ngModel)]="preferredHeight"
        (ngModelChange)="onHeightChange($event)"
        placeholder="Enter desired height in inches"
      />
      <p class="extra-height-note">Free Of Cost</p>
    </div>

    <!-- Customization Notes -->
    <div class="customization-section">
      <h4>Customization Notes <span class="optional-text">(Optional)</span></h4>
      <textarea
        rows="3"
        [(ngModel)]="customizationNotes"
        placeholder="e.g., V-neck preferred, height 42 inches"
      ></textarea>
    </div>

    <!-- Sticky Footer -->
    <div class="sticky-footer" *ngIf="product">
      <div class="footer-content">
        <div class="footer-price">
          <p>
            Base Price: ‚Çπ{{ basePrice }}
            <span *ngIf="sleeveExtra"> + ‚Çπ{{ sleeveExtra }}</span>
            <span *ngIf="heightExtra"> + ‚Çπ{{ heightExtra }}</span>
            <span *ngIf="sleeveExtra || heightExtra"> = ‚Çπ{{ totalPrice }}</span>
          </p>
        </div>

        <button
          class="footer-add-btn"
          type="button"
          [disabled]="!isFormValid()"
          (click)="addToCart()"
        >
          Add to Cart
        </button>

        <!-- WhatsApp Floating Button -->
        <a
          class="whatsapp-float"
          [href]="getWhatsappLink()"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Chat on WhatsApp"
        >
          <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" />
        </a>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <div class="skeleton-loader">
    <div class="skeleton image"></div>
    <div class="skeleton text"></div>
    <div class="skeleton text short"></div>
    <div class="skeleton button"></div>
  </div>
</ng-template>

