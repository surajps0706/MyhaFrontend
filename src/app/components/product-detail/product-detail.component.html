<!-- Back Button (Global Premium)
<div class="back-btn-global back-btn-sticky">
  <button class="back-btn" (click)="goBack()">
    ‚Üê
  </button>
</div> -->

<div class="product-detail-container" *ngIf="product; else loading">
  <!-- Left: Image Section -->
  <div class="image-section">
    <div class="thumbnails">
      <img
        *ngFor="let img of product.images; let i = index"
        [src]="img"
        [alt]="product.name + ' thumbnail ' + (i + 1)"
        loading="lazy"
        (click)="selectImage(img)"
        [class.active]="img === selectedImage"
      />
    </div>
    <div class="main-image">
      <img [src]="selectedImage" [alt]="product.name" />
    </div>
  </div>

  <!-- Right: Info Section -->
  <div class="info-section">
    <h2 class="product-name">{{ product.name }}</h2>

    <!-- Price -->
 <div class="price-container">
  <span  class="price-label">Price:</span>

  <!-- ‚úÖ Show price if available -->
  <span *ngIf="!product.isSoldOut; else soldOut" class="price-value">
    ‚Çπ{{ product.price }}
  </span>

  <!-- ‚úÖ Show Sold Out text otherwise -->
  <ng-template #soldOut>
    <span class="sold-out-text">Sold Out</span>
  </ng-template>
</div>


    <!-- Collapsible Description -->
    <div class="collapsible-description">
      <button class="toggle-btn" type="button" (click)="toggleDescription()">
        {{ showDescription ? 'Hide' : 'Show' }} Description
        <span [class.rotated]="showDescription">‚ñº</span>
      </button>
      <div
        class="description-content"
        [class.open]="showDescription"
        [innerHTML]="formattedDescription"
      ></div>
    </div>

    <div class="points">
      <h3>Quick Note:</h3>
  <ul class="product-points">
    <li>Each piece is lovingly made to order, so we‚Äôre unable to offer COD, returns, or exchanges.</li>
    <li>Prices may vary a little based on your customizations, and we currently accept prepaid orders only.</li>
    <li>Please allow 10‚Äì20 working days for your order to be handcrafted and delivered to you.</li>
  </ul>
</div>


    <!-- Sizing Mode Switch -->
    <div class="sizing-mode-container">
      <div class="sizing-mode-label">Choose Sizing Mode:</div>
      <div class="sizing-mode-switch">
        <button
          type="button"
          (click)="setSizingMode('size')"
          [class.active]="sizingMode === 'size'"
        >
          Standard Size
        </button>
        <button
          type="button"
          (click)="setSizingMode('measurements')"
          [class.active]="sizingMode === 'measurements'"
        >
          Custom Measurements
        </button>
      </div>
    </div>

    <!-- Size Selection -->
    <div class="select-row">
      <label for="size">Size:</label>
      <select
        id="size"
        class="size-dropdown"
        [(ngModel)]="product.selectedSize"
        (ngModelChange)="onSizeChange($event)"
        [disabled]="sizeDisabled"
      >
        <option *ngFor="let size of standardSizes" [value]="size">
          {{ size }}
        </option>
      </select>

      <div class="size-chart-link" (click)="showSizeChart = !showSizeChart">
        üìè View Size Chart
      </div>
      <div class="size-chart-img" *ngIf="showSizeChart">
        <img
          src="https://res.cloudinary.com/dw35epojg/image/upload/v1754143979/size-chart_bu3k4d.jpg"
          alt="Size chart"
        />
      </div>

      <p *ngIf="sizeModeNote" class="customization-hint" style="margin-top: 6px">
        {{ sizeModeNote }}
      </p>
    </div>

    <!-- Measurements -->
    <div class="measurements-section" [class.disabled]="measurementsDisabled">
      <h4>Measurements:</h4>
      <div class="measurements-grid">
        <div class="measurement-row" *ngFor="let field of measurementFields">
          <label>
            {{ field.label }}
            <span
              *ngIf="isRequired(field.key) && !measurementsDisabled"
              class="required-star"
              >*</span
            >
          </label>

          <input
            type="text"
            [(ngModel)]="measurements[field.key]"
            (ngModelChange)="onMeasurementChanged(field.key, $event)"
            [name]="field.key"
            placeholder="in inches"
            [required]="isRequired(field.key) && !measurementsDisabled"
            [disabled]="measurementsDisabled"
            #inputRef="ngModel"
            [ngClass]="{
              invalid:
                !measurementsDisabled &&
                isRequired(field.key) &&
                inputRef.invalid &&
                inputRef.touched
            }"
            (blur)="inputRef.control.markAsTouched()"
          />

          <div
            *ngIf="
              !measurementsDisabled &&
              isRequired(field.key) &&
              inputRef.invalid &&
              inputRef.touched
            "
            class="error-msg"
          >
            {{ field.label }} is required
          </div>
        </div>
      </div>

      <p *ngIf="measModeNote" class="customization-hint" style="margin-top: 6px">
        {{ measModeNote }}
      </p>
    </div>

<!-- Sleeve Customization Toggle -->
<div class="sleeve-toggle-wrapper">
  <label class="switch">
    <input
      type="checkbox"
      [(ngModel)]="enableSleeveCustomization"
      (change)="onSleeveToggle()"
    />
    <span class="slider round"></span>
  </label>
  <span class="toggle-label">Sleeve Customization</span>
</div>

<!-- Sleeve Options (visible only if toggle is ON) -->
<div class="sleeve-options" *ngIf="enableSleeveCustomization">
  <h4>Sleeve Type:</h4>
  <div class="sleeve-list">
    <label *ngFor="let option of sleeveOptions">
      <input
        type="radio"
        name="sleeve"
        [value]="option"
        [(ngModel)]="selectedSleeve"
      />
      {{ option.name }}
      ({{ option.price > 0 ? '+‚Çπ' + option.price : 'Free' }})
    </label>
  </div>
</div>


<!-- Height Customization Toggle -->
<div class="height-toggle-wrapper">
  <label class="switch">
    <input type="checkbox" [(ngModel)]="enableHeightCustomization" (change)="onHeightToggle()" />
    <span class="slider round"></span>
  </label>
  <span class="toggle-label">Height Customization</span>
</div>

<!-- Show only when enabled -->
<div *ngIf="enableHeightCustomization" class="extra-height-section">
  <h4>
    Height 
    <span *ngIf="isKurti">(‚Çπ{{ extraHeightPrice }})</span>
    <span *ngIf="!isKurti">(Optional)</span>
  </h4>

  <input
    class="extra-height"
    type="text"
    [(ngModel)]="preferredHeight"
    (ngModelChange)="onHeightChange($event)"
    placeholder="Enter desired height in inches"
  />

  <p class="extra-height-note" *ngIf="isKurti">
    *Extra ‚Çπ150 will be charged if height exceeds 35 inches.
  </p>
  <p class="extra-height-note" *ngIf="!isKurti">
    Free Of Cost
  </p>
</div>


<!-- Neck Customization Toggle -->
<div class="neck-toggle-wrapper">
  <label class="switch">
    <input
      type="checkbox"
      [(ngModel)]="enableNeckCustomization"
      (change)="onNeckToggle()"
    />
    <span class="slider round"></span>
  </label>
  <span class="toggle-label">Neck Customization</span>
</div>

<!-- Neck Customization Input -->
<div *ngIf="enableNeckCustomization" class="neck-section">
  <h4>Front/Back Neck Details</h4>
  <input
    type="text"
    class="neck-input"
    [(ngModel)]="neckCustomizationText"
    placeholder="Describe your neck customization (e.g., V-Neck, U-Neck)"
  />
</div>




    <!-- Customization Notes -->
    <div class="customization-section">
      <h4>
        Customization Notes <span class="optional-text">(Optional)</span>
      </h4>
      <textarea
        rows="3"
        [(ngModel)]="customizationNotes"
        placeholder="e.g., V-neck preferred, height 42 inches"
      ></textarea>
    </div>

    <!-- ‚úÖ Reviews Section -->
    <div class="reviews-section">
      <h3>Customer Reviews</h3>

      <!-- Reviews List -->
      <div *ngIf="reviews.length > 0; else noReviews">
        <div *ngFor="let r of reviews" class="review-card">
          <div class="review-header">
            <span class="reviewer-name">{{ r.name }}</span>
            <span class="review-rating">
              <ng-container *ngFor="let star of [1,2,3,4,5]">
                <span class="star" [class.filled]="star <= r.rating">‚òÖ</span>
              </ng-container>
              <span class="rating-text">{{ r.rating }}/5</span>
            </span>
          </div>
          <p class="review-comment">‚Äú{{ r.comment }}‚Äù</p>

          <!-- ‚úÖ Show uploaded image if available -->
          <div *ngIf="r.image || r.imageUrl" class="review-image">
            <img [src]="r.image || r.imageUrl" alt="Review image by {{ r.name }}" />
          </div>
        </div>
      </div>
      <ng-template #noReviews>
        <p class="no-reviews">No reviews yet. Be the first to review!</p>
      </ng-template>

      <!-- Write Review -->
      <h4>Write a Review</h4>
      <form (ngSubmit)="submitReview()" class="review-form">
        <input
          [(ngModel)]="newReview.name"
          name="name"
          placeholder="Your Name"
          required
          class="form-input"
        />

        <!-- ‚≠ê Star rating -->
        <div class="star-input">
          <label *ngFor="let star of [1,2,3,4,5]">
            <input
              type="radio"
              name="rating"
              [value]="star"
              [(ngModel)]="newReview.rating"
              required
            />
            <span class="star" [class.filled]="star <= newReview.rating">‚òÖ</span>
          </label>
        </div>

        <!-- Comment -->
        <textarea
          [(ngModel)]="newReview.comment"
          name="comment"
          placeholder="Write your review..."
          required
          class="form-textarea"
        ></textarea>

        <div class="upload-section">
          <label for="review-image" class="upload-label">
            <i class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" class="feather" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="18" height="18">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M3 7h4l2-3h6l2 3h4v13H3V7z" />
                <circle cx="12" cy="13" r="3" />
              </svg>
            </i>
            Upload Photo
          </label>
          <input id="review-image" type="file" accept="image/*" (change)="onImageSelected($event)" class="form-file" />
        </div>

        <!-- Submit button -->
        <button type="submit"  class="submit-btn">Submit Review</button>
      </form>
    </div>



    <!-- Sticky Footer -->
    <div class="sticky-footer" *ngIf="product">
      <div class="footer-content">
   <div class="price-breakdown">
  <span>Base: ‚Çπ{{ basePrice }}</span>
  <span *ngIf="bustExtra">Bust Size: +‚Çπ{{ bustExtra }}</span>
  <span *ngIf="sleeveExtra">Sleeve: +‚Çπ{{ sleeveExtra }}</span>
  <span *ngIf="heightExtra">Height: +‚Çπ{{ heightExtra }}</span>
  <strong *ngIf="bustExtra || sleeveExtra || heightExtra">
    Total: ‚Çπ{{ totalPrice }}
  </strong>
</div>


       <button
  class="footer-add-btn"
  type="button"
  [disabled]="product.isSoldOut || !isFormValid()"
  (click)="addToCart()"
>
  {{ product.isSoldOut ? 'Sold Out' : 'Add to Cart' }}
</button>


        <!-- WhatsApp Floating Button -->
        <a
          class="whatsapp-float"
          [href]="getWhatsappLink()"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Chat on WhatsApp"
        >
          <img
            src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg"
            alt="WhatsApp"
          />
        </a>
      </div>
    </div>
  </div>

<!-- ================================
     ‚≠ê You May Also Like Section
================================= -->
<div class="recommend-section" *ngIf="recommendedProducts.length > 0">
  <h3 class="recommend-title">You May Also Like</h3>
  <div class="recommend-grid">
    <a
      class="recommend-card"
      *ngFor="let rec of recommendedProducts"
      [routerLink]="['/product', rec.id]">

      <!-- Image -->
      <img [src]="rec.images?.[0]" [alt]="rec.name" />

      <!-- Info -->
      <div class="recommend-info">
        <div class="recommend-name">{{ rec.name }}</div>
        <div class="recommend-price">‚Çπ{{ rec.price }}</div>
      </div>
    </a>
  </div>
</div>





</div>

<!-- Toast Notification -->
<div class="toast" *ngIf="showToast">
  ‚úÖ {{ product?.name }} added to cart!
</div>

<ng-template #loading>
  <div class="skeleton-loader">
    <div class="skeleton image"></div>
    <div class="skeleton text"></div>
    <div class="skeleton text short"></div>
    <div class="skeleton button"></div>
  </div>
</ng-template>
