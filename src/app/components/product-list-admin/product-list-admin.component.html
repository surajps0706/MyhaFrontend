<div class="admin-container">
  <h2>üì¶ Manage Products</h2>

  <!-- Product List -->
  <div *ngIf="!editingProduct" class="table-container">
    <!-- ‚úÖ Added cdkDropList -->
    <table class="admin-table" cdkDropList (cdkDropListDropped)="drop($event)">
      <thead>
        <tr>
          <th style="width: 40px;"></th> <!-- Drag handle column -->
          <th>Image</th>
          <th>Name</th>
          <th>Price</th>
          <th>Category</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- ‚úÖ Added cdkDrag on row -->
        <tr *ngFor="let p of products" cdkDrag>
          <td class="drag-cell" cdkDragHandle title="Drag to reorder">‚ò∞</td>
          <td>
            <img [src]="p.images[0]" alt="{{p.name}}" class="thumb" />
          </td>
          <td>{{ p.name }}</td>
          <td>
            <ng-container *ngIf="!p.isSoldOut; else soldOut">
              ‚Çπ{{ p.price }}
            </ng-container>
            <ng-template #soldOut>
              <span class="sold-out-badge">Sold Out</span>
            </ng-template>
          </td>
          <td>{{ p.category }}</td>
          <td>
            <button class="btn edit" (click)="editProduct(p)">‚úèÔ∏è Edit</button>
            <button class="btn delete" (click)="deleteProduct(p.id)">üóëÔ∏è Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Edit Form -->
  <div *ngIf="editingProduct" class="edit-form">
    <h3>‚úèÔ∏è Edit Product</h3>
    <form (ngSubmit)="saveProduct()">
      <label>Name</label>
      <input [(ngModel)]="editingProduct.name" name="name" required />

      <label class="soldout-toggle">
        <input
          type="checkbox"
          [(ngModel)]="editingProduct.isSoldOut"
          name="isSoldOut"
        />
        <span>Mark as Sold Out</span>
      </label>

      <label>Price</label>
      <input type="number" [(ngModel)]="editingProduct.price" name="price" required />

      <label>Category</label>
      <input [(ngModel)]="editingProduct.category" name="category" required />

      <!-- ‚úÖ Fabric Pricing Toggle -->
      <label class="fabric-toggle">
        <input
          type="checkbox"
          [(ngModel)]="editingProduct.enableFabricPrice"
          name="enableFabricPrice"
        />
        <span>Enable Fabric-Based Sleeve Pricing</span>
      </label>


      <label>Stock Left</label>
<div class="stock-control">
  <button type="button" (click)="decreaseStock()">‚àí</button>
  <input
    type="number"
    [(ngModel)]="editingProduct.stock"
    name="stock"
    min="0"
    required
  />
  <button type="button" (click)="increaseStock()">+</button>
</div>


      <!-- ‚úÖ Fabric Base Price (shown only when enabled) -->
      <div *ngIf="editingProduct.enableFabricPrice">
        <label>Fabric Base Price</label>
        <select [(ngModel)]="editingProduct.fabricBasePrice" name="fabricBasePrice">
          <option [value]="100">100</option>
          <option [value]="200">200</option>
          <option [value]="300">300</option>
        </select>
      </div>

      <label>Description</label>
      <textarea [(ngModel)]="editingProduct.description" name="description"></textarea>

      <label>Colors (comma separated)</label>
      <input [(ngModel)]="editingProduct.colors" name="colors" />

      <label>Image URLs (comma separated)</label>
      <textarea [(ngModel)]="editingProduct.images" name="images"></textarea>

      <div class="form-actions">
        <button type="submit" class="btn save">üíæ Save</button>
        <button type="button" class="btn cancel" (click)="cancelEdit()">‚úñ Cancel</button>
      </div>
    </form>
  </div>
</div>
